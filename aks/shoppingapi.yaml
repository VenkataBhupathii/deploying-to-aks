apiVersion: apps/v1
kind: Deployment
metadata:
 name: shoppingapi-deployment
 labels:
   app: shoppingapi
spec:
 replicas: 1
 selector:
   matchLabels:
     app: shoppingapi
 template:
   metadata:
     labels:
       app: shoppingapi
   spec:
     containers:
       - name: shoppingapi
         image: venkatabhupathi/shopping-api:latest
         imagePullPolicy: Always
         ports:
           - containerPort: 8080  # Changed to 8080
         env:
           - name: ASPNETCORE_ENVIRONMENT
             value: Development
           - name: MongoDBConnectionString    # Added this env var
             valueFrom:
               configMapKeyRef:
                 name: mongo-configmap
                 key: connection_string
           - name: DatabaseSettings__ConnectionString
             valueFrom:
               configMapKeyRef:
                 name: mongo-configmap
                 key: connection_string
         resources:
           requests:
             memory: "32Mi"
             cpu: "0.05"
           limits:
             memory: "64Mi"
             cpu: "0.1"
     imagePullSecrets:
       - name: dockerhub-secret

---
apiVersion: v1
kind: Service
metadata:
 name: shoppingapi-service
spec:
 selector:
   app: shoppingapi
 ports:
   - protocol: TCP
     port: 80
     targetPort: 8080 